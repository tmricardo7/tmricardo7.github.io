<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Rick On Code Blog</title>
        <link>https://tmricardo7.github.io/blog</link>
        <description>Rick On Code Blog</description>
        <lastBuildDate>Wed, 28 Dec 2022 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Minimal API in .NET 7 using AWS Lambda]]></title>
            <link>https://tmricardo7.github.io/blog/first-blog-post</link>
            <guid>first-blog-post</guid>
            <pubDate>Wed, 28 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[The newest version of .NET is already released and it comes with a LOT of new improvements that we might want to have in our APIs, including the new C# 11 that is used by default.]]></description>
            <content:encoded><![CDATA[<p>The newest version of .NET is already released and it comes with a LOT of new improvements that we might want to have in our APIs, including the new C# 11 that is used by default.</p><p>Minimal APIs is one of the most popular features that were added in .NET 6, taking so much love from all the .NET community, as they are a <strong>lightweight</strong> alternative to the controllers that have been used for a long time.</p><p>With the new .NET 7 version there are more features for Minimal APIs, for example:</p><ul><li><strong>Filters</strong> that provide a way to add business logic before or after the execution of the endpoint, these are the equivalent of what we used in the old-fashioned Web API controllers, using the <code>IActionFilter</code>.</li><li>Improved <strong>OpenAPI</strong> support to describe our endpoints using the NuGet package <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.OpenApi/" target="_blank" rel="noopener noreferrer">Microsoft.AspNetCore.OpenApi</a></li></ul><p>You can see all the new features on the official site <a href="https://learn.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-7.0?view=aspnetcore-7.0#minimal-apis" target="_blank" rel="noopener noreferrer">Minimal API in .NET 7</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="net-in-aws-lambda">.NET in AWS Lambda<a class="hash-link" href="#net-in-aws-lambda" title="Direct link to heading">​</a></h4><p>AWS Lambda supports .NET runtime, but only the Long Term Support (LTS) versions, for now .NET Core 3.1 and .NET 6. </p><p>So, what if we want to deploy a .NET 7 app into AWS Lambda??</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-a-net-7-minimal-api-into-aws-lambda">Deploying a .NET 7 Minimal API into AWS Lambda<a class="hash-link" href="#deploying-a-net-7-minimal-api-into-aws-lambda" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-basics">The basics<a class="hash-link" href="#the-basics" title="Direct link to heading">​</a></h4><p>First, we need a minimal API created. In this case, this will be our app, which is the template provided by .NET when creating a new API in .NET 7.</p><p><em>Program.cs</em></p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var builder = WebApplication.CreateBuilder(args);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Add services to the container.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">builder.Services.AddEndpointsApiExplorer();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">builder.Services.AddSwaggerGen();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var app = builder.Build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Configure the HTTP request pipeline.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if (app.Environment.IsDevelopment())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    app.UseSwagger();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    app.UseSwaggerUI();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">app.UseHttpsRedirection();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var summaries = new[]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">app.MapGet("/weatherforecast", () =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var forecast = Enumerable.Range(1, 5).Select(index =&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        new WeatherForecast</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DateOnly.FromDateTime(DateTime.Now.AddDays(index)),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Random.Shared.Next(-20, 55),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            summaries[Random.Shared.Next(summaries.Length)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .ToArray();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return forecast;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.WithName("GetWeatherForecast")</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.WithOpenApi();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">app.Run();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">internal record WeatherForecast(DateOnly Date, int TemperatureC, string? Summary)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, to be able to host your app in an AWS Lambda environment you will need to add the NuGet package
<a href="https://www.nuget.org/packages/Amazon.Lambda.AspNetCoreServer.Hosting/1.3.1" target="_blank" rel="noopener noreferrer">Amazon.Lambda.AspNetCoreServer.Hosting</a> to your project and add the following code into yours.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">builder.Services.AddAWSLambdaHosting(LambdaEventSource.HttpApi);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>AddAWSLambdaHosting</code> enables us to run our app in AWS Lambda, and we use <code>LambdaEventSource.HttpApi</code> because we will use an <strong>API Gateway</strong> of type <strong>HTTP API</strong>.</p><p>Ok now we have our Minimal API app ready to deploy!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-aws-lambda">Creating the AWS Lambda<a class="hash-link" href="#creating-the-aws-lambda" title="Direct link to heading">​</a></h4><p>If we go to the AWS Console to create a new Lambda Function, we will see the supported runtimes </p><p><img loading="lazy" src="/assets/images/Pasted image 20221202125442-158ff06e4234a77b0cae0e54d7e8d50f.png" width="234" height="512" class="img_ev3q"></p><p>As we already know AWS Lambda doesn't support the .NET 7 runtime, so what should we do?? </p><p>Well AWS Lambda offers two ways to be to do it. First, we can use a container image with .NET 7, or the second way we will use is to use the Lambda custom runtime ability.</p><p>There are some requirements to run our app in a custom runtime.</p><ol><li>We will need to provide a Zip with an executable called <code>bootstrap</code>.</li><li>We need a <strong>self-contained app</strong>, this can be specified in our app publish settings. </li><li>We also need to set our release for <code>linux_x64</code>, this is because AWS uses <strong>Amazon Linux</strong></li></ol><p>So first, we create our function.</p><p>As <strong>Runtime</strong> we can select any of the custom runtime options.
<img loading="lazy" src="data:image/png;base64,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" width="400" height="97" class="img_ev3q"></p><p>In this app we will use Amazon Linux 2 which is an improved operating system, you can read more about it in the <a href="https://aws.amazon.com/amazon-linux-2" target="_blank" rel="noopener noreferrer">AWS Official Documentation</a></p><p>As <strong>architecture</strong>, we will use <strong>x86_64</strong>, and then we proceed to create our function!</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="submitting-our-app">Submitting our app<a class="hash-link" href="#submitting-our-app" title="Direct link to heading">​</a></h5><p>Now that we created our Lambda function we can now proceed to upload our code.</p><p>First we will need to set some properties in our <code>.csproj</code></p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">PropertyGroup</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">OutputType</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Exe</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">OutputType</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--We first need to have an executable for output, so our custom runtime could know what to execute.--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">TargetFramework</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">net7.0</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">TargetFramework</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--Part of our app configuration--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">ImplicitUsings</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">enable</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">ImplicitUsings</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--Part of our app configuration--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Nullable</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">enable</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Nullable</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--Part of our app configuration--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">AWSProjectType</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Lambda</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">AWSProjectType</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--Property required to run in AWS Lambda--&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">AssemblyName</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">bootstrap</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">AssemblyName</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--The file that will need to be executed--&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">PropertyGroup</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that we will create an executable called <code>bootstrap</code>, this is exactly what we needed as part of our requirements.</p><p>Now we can publish our app using the following settings.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; dotnet publish -c Release --self-contained true -r linux-x64 -o publish</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will output our self-contained app in a <code>publish</code> folder.</p><p>Now you will need to zip all the files inside the <code>publish</code> folder and upload your code to AWS. So inside our new AWS Lambda function we go to <code>Upload from</code> and search for our new .zip file.</p><p><img loading="lazy" src="/assets/images/Pasted image 20221202151524-bfc5070f19815c43be96a9643e7240bf.png" width="1632" height="189" class="img_ev3q"></p><p>And finally, in the Lambda function edit your <strong>Runtime Settings</strong>, and change the Handler property.</p><p>The handler property is a way to tell your Lambda what method to invoke, as we named our assembly <code>bootstrap</code> we should use the same name in the handler property.</p><p><img loading="lazy" src="/assets/images/Pasted image 20221202152101-ce383ee5043726fca6c171ad9549c628.png" width="711" height="353" class="img_ev3q"></p><p>Now your AWS Lambda function is ready! But how can we trigger our endpoints?? and what URL will be used??</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-our-api-gateway">Creating our API Gateway<a class="hash-link" href="#creating-our-api-gateway" title="Direct link to heading">​</a></h4><p>We now proceed to create an API Gateway in AWS, using the HTTP API type. Then you proceed to select the settings for your integrations, which will connect the routes from the API gateway to our backend resources.</p><p><img loading="lazy" src="/assets/images/Pasted image 20221206120453-71056b6d77dc510a9927118b46dd736e.png" width="1184" height="508" class="img_ev3q"></p><ul><li>The Integrations are of type <strong>Lambda</strong></li><li>Select the <strong>region</strong> to lookup at your Lambda Function.</li><li>Select your Lambda function</li><li>The version doesn't matter in this context, so just use <code>2.0</code></li><li>And finally, name your new API Gateway</li></ul><p>When creating an API Gateway you can have multiple integrations linked, this means we can link multiple Lambda Functions, but how do we know what lambda to run? </p><p>We now need to link our routes to the specific integration. In our case, we will define the route <code>/weatherforecast</code> and link it with our Lambda Function. You can add many routes if you want to.</p><p><img loading="lazy" src="/assets/images/Pasted image 20221206121450-2ccc0dfa0b0c0ec3f9656261a8b11f9f.png" width="965" height="240" class="img_ev3q"></p><p>And finally in the Stages settings, use the default values.</p><p>You can now call the route and test your endpoint.</p><p>If everything is good, you will see logs for your Lambda Function in AWS CloudWatch</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-performance">Review Performance<a class="hash-link" href="#review-performance" title="Direct link to heading">​</a></h4><p>AWS Cloudwatch provides information about the memory used and the initial time it took to start the Lambda Function and get hot. The Cold Start issue is a common concern that we have to deal in Lambda Functions, our function gets cold if it's inactive for a while(5 to 7 minutes), and it will take longer to start again.</p><p>I tested our new Lambda function and it says:
<code>Max Memory Used: 176 MB Init Duration: 923.70 ms</code> </p><p>By seeing these results, We can see that the performance might not be optimal compared to the same project running on .NET 6, which triggered these results:
<code>Max Memory Used: 82 MB Init Duration: 384.08 ms</code></p><p>The reason behind this is that we are running a self-contained package which is bigger and it might take more time for the environment to be ready.</p><p>Ok, so .NET 7 brings a lot of good features for our Minimal APIs and we might want to have them without worrying too much about the performance, that's ok. But what if we want to improve the performance a little bit more!?</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="native-ahead-of-timeaot-to-the-rescue">Native Ahead-of-time(AOT) to the Rescue!<a class="hash-link" href="#native-ahead-of-timeaot-to-the-rescue" title="Direct link to heading">​</a></h4><p>.NET 7 brings Native AOT for the very first time in our framework, using this feature we can now create a self-contained app that generated code at application build time, instead of run-time.</p><p>To enable AOT in your project just add to your <code>.csproj</code> property group.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">PropertyGroup</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">PublishAot</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">PublishAot</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">PropertyGroup</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Native AOT is very limited for now and we can't cross-compile it. So we will need to use Linux to build and publish the zip file. </p><p>I was able to publish an AOT version of our project into a Lambda Function, I might explain the process in another blog post.</p><p>For now I'm going to post the comparison between .NET 7, .NET 7 AOT and .NET 6.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Framework   | Memory Used | Duration    |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ----------- | ----------- | ----------- |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| .NET 6      | 82 MB       | 384ms       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| .NET 7      | 176 MB      | 923ms       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| .NET 7 (AOT)| 105 MB      | 389ms       |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you see AOT reduced the memory used by 40% and the duration by almost 60%.</p>]]></content:encoded>
            <category>hola</category>
            <category>docusaurus</category>
        </item>
    </channel>
</rss>